{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ampersona.dev/schema/v1.0/ampersona.schema.json",
  "title": "ampersona v1.0 â€” Agent Identity, Authority, and Gates",
  "description": "Platform for AI agent identity, authority, and trust progression.",
  "type": "object",
  "required": ["name", "role", "psychology", "voice"],
  "additionalProperties": false,
  "properties": {
    "$schema": { "type": "string" },
    "version": { "type": "string", "const": "1.0" },
    "name": {
      "type": "string",
      "minLength": 1,
      "description": "Display name (AdjectiveNoun format recommended)."
    },
    "role": {
      "type": "string",
      "minLength": 1,
      "description": "One-line role description."
    },
    "backstory": {
      "type": "string",
      "description": "Free-text origin context."
    },
    "signature": { "$ref": "#/$defs/Signature" },
    "psychology": { "$ref": "#/$defs/Psychology" },
    "voice": { "$ref": "#/$defs/Voice" },
    "capabilities": { "$ref": "#/$defs/Capabilities" },
    "directives": { "$ref": "#/$defs/Directives" },
    "authority": { "$ref": "#/$defs/Authority" },
    "gates": {
      "type": "array",
      "items": { "$ref": "#/$defs/Gate" }
    },
    "audit": { "$ref": "#/$defs/AuditConfig" },
    "ampersona_contract": {
      "type": "string",
      "description": "Optional contract version this persona targets (e.g. '1.0')."
    }
  },
  "$defs": {
    "UnitFloat": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0
    },
    "Psychology": {
      "type": "object",
      "required": ["neural_matrix", "traits"],
      "additionalProperties": false,
      "properties": {
        "neural_matrix": {
          "type": "object",
          "required": ["creativity", "empathy", "logic", "adaptability", "charisma", "reliability"],
          "additionalProperties": false,
          "properties": {
            "creativity":   { "$ref": "#/$defs/UnitFloat" },
            "empathy":      { "$ref": "#/$defs/UnitFloat" },
            "logic":        { "$ref": "#/$defs/UnitFloat" },
            "adaptability": { "$ref": "#/$defs/UnitFloat" },
            "charisma":     { "$ref": "#/$defs/UnitFloat" },
            "reliability":  { "$ref": "#/$defs/UnitFloat" }
          }
        },
        "traits": {
          "type": "object",
          "required": ["ocean", "mbti"],
          "additionalProperties": false,
          "properties": {
            "ocean": {
              "type": "object",
              "required": ["openness", "conscientiousness", "extraversion", "agreeableness", "neuroticism"],
              "additionalProperties": false,
              "properties": {
                "openness":          { "$ref": "#/$defs/UnitFloat" },
                "conscientiousness": { "$ref": "#/$defs/UnitFloat" },
                "extraversion":      { "$ref": "#/$defs/UnitFloat" },
                "agreeableness":     { "$ref": "#/$defs/UnitFloat" },
                "neuroticism":       { "$ref": "#/$defs/UnitFloat" }
              }
            },
            "mbti": {
              "type": "string",
              "enum": ["ISTJ","ISFJ","INFJ","INTJ","ISTP","ISFP","INFP","INTP","ESTP","ESFP","ENFP","ENTP","ESTJ","ESFJ","ENFJ","ENTJ"]
            },
            "temperament": { "type": "string" }
          }
        },
        "moral_compass": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "alignment": {
              "type": "string",
              "enum": ["lawful-good","neutral-good","chaotic-good","lawful-neutral","true-neutral","chaotic-neutral","lawful-evil","neutral-evil","chaotic-evil"]
            },
            "core_values": {
              "type": "array",
              "items": { "type": "string", "minLength": 1 },
              "minItems": 1
            }
          }
        },
        "emotional_profile": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "base_mood": { "type": "string", "minLength": 1 },
            "volatility": { "$ref": "#/$defs/UnitFloat" }
          }
        }
      }
    },
    "Voice": {
      "type": "object",
      "required": ["style"],
      "additionalProperties": false,
      "properties": {
        "style": {
          "type": "object",
          "required": ["descriptors", "formality", "verbosity"],
          "additionalProperties": false,
          "properties": {
            "descriptors": {
              "type": "array",
              "items": { "type": "string", "minLength": 1 },
              "minItems": 1
            },
            "formality": { "$ref": "#/$defs/UnitFloat" },
            "verbosity": { "$ref": "#/$defs/UnitFloat" }
          }
        },
        "syntax": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "structure": { "type": "string" },
            "contractions": { "type": "boolean" }
          }
        },
        "idiolect": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "catchphrases": {
              "type": "array",
              "items": { "type": "string" }
            },
            "forbidden_words": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "tts": {
          "type": "object",
          "required": ["provider", "voice_id"],
          "additionalProperties": true,
          "properties": {
            "provider": { "type": "string", "minLength": 1 },
            "voice_id": { "type": "string", "minLength": 1 },
            "stability": { "$ref": "#/$defs/UnitFloat" },
            "similarity_boost": { "$ref": "#/$defs/UnitFloat" },
            "speed": { "$ref": "#/$defs/UnitFloat" }
          }
        }
      }
    },
    "Skill": {
      "type": "object",
      "required": ["name", "description"],
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "description": { "type": "string" },
        "priority": { "type": "integer", "minimum": 1, "maximum": 10 }
      }
    },
    "Capabilities": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "skills": {
          "type": "array",
          "items": { "$ref": "#/$defs/Skill" }
        }
      }
    },
    "Directives": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "core_drive": { "type": "string", "minLength": 1 },
        "goals": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        },
        "constraints": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 }
        }
      }
    },
    "Authority": {
      "type": "object",
      "required": ["autonomy"],
      "additionalProperties": false,
      "properties": {
        "autonomy": {
          "type": "string",
          "enum": ["readonly", "supervised", "full"]
        },
        "scope": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "workspace_only": { "type": "boolean" },
            "allowed_paths": { "type": "array", "items": { "type": "string" } },
            "forbidden_paths": { "type": "array", "items": { "type": "string" } }
          }
        },
        "actions": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "allow": { "type": "array", "items": { "type": "string" } },
            "deny": {
              "type": "array",
              "items": {
                "oneOf": [
                  { "type": "string" },
                  {
                    "type": "object",
                    "required": ["action", "reason"],
                    "additionalProperties": false,
                    "properties": {
                      "action": { "type": "string" },
                      "reason": { "type": "string" },
                      "compliance_ref": { "type": "string" }
                    }
                  }
                ]
              }
            },
            "scoped": {
              "type": "object",
              "additionalProperties": {
                "type": "object",
                "required": ["$type"],
                "properties": {
                  "$type": { "type": "string" }
                }
              }
            }
          }
        },
        "limits": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "max_actions_per_hour": { "type": "integer", "minimum": 1 },
            "max_cost_per_day_cents": { "type": "integer", "minimum": 0 },
            "require_approval_for": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["low_risk", "medium_risk", "high_risk"]
              }
            }
          }
        },
        "elevations": {
          "type": "array",
          "items": { "$ref": "#/$defs/Elevation" }
        },
        "delegation": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "can_delegate_to": { "type": "array", "items": { "type": "string" } },
            "max_depth": { "type": "integer", "minimum": 1 }
          }
        },
        "ext": { "type": "object" }
      }
    },
    "Elevation": {
      "type": "object",
      "required": ["id", "grants", "requires", "ttl_seconds"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "grants": { "type": "object" },
        "requires": { "type": "string", "enum": ["auto", "human", "quorum"] },
        "ttl_seconds": { "type": "integer", "minimum": 1 },
        "reason_required": { "type": "boolean" }
      }
    },
    "Gate": {
      "type": "object",
      "required": ["id", "direction", "from_phase", "to_phase", "criteria"],
      "additionalProperties": false,
      "properties": {
        "id": { "type": "string", "minLength": 1 },
        "direction": { "type": "string", "enum": ["promote", "demote"] },
        "enforcement": { "type": "string", "enum": ["enforce", "observe"] },
        "priority": { "type": "integer" },
        "cooldown_seconds": { "type": "integer", "minimum": 0 },
        "from_phase": { "type": ["string", "null"] },
        "to_phase": { "type": "string", "minLength": 1 },
        "criteria": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/$defs/Criterion" }
        },
        "metrics_schema": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "type": { "type": "string", "enum": ["boolean", "integer", "number", "string"] }
            }
          }
        },
        "approval": { "type": "string", "enum": ["auto", "human", "quorum"] },
        "on_pass": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "authority_overlay": { "type": "object" }
          }
        }
      }
    },
    "Criterion": {
      "type": "object",
      "required": ["metric", "op", "value"],
      "additionalProperties": false,
      "properties": {
        "metric": { "type": "string", "minLength": 1 },
        "op": { "type": "string", "enum": ["eq", "neq", "gt", "gte", "lt", "lte"] },
        "value": {}
      }
    },
    "Signature": {
      "type": "object",
      "required": ["algorithm", "key_id", "signer", "canonicalization", "signed_fields", "created_at", "digest", "value"],
      "additionalProperties": false,
      "properties": {
        "algorithm": { "type": "string", "const": "ed25519" },
        "key_id": { "type": "string", "minLength": 1 },
        "signer": { "type": "string", "minLength": 1 },
        "canonicalization": { "type": "string", "const": "JCS-RFC8785" },
        "signed_fields": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
        "created_at": { "type": "string" },
        "digest": { "type": "string" },
        "value": { "type": "string" },
        "public_key": { "type": "string" }
      }
    },
    "AuditConfig": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "log_decisions": { "type": "boolean" },
        "log_gate_transitions": { "type": "boolean" },
        "retention_days": { "type": "integer", "minimum": 1 },
        "compliance_markers": { "type": "array", "items": { "type": "string" } }
      }
    }
  }
}
